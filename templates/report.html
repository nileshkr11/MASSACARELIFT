<!DOCTYPE html>
<html>
<head>
  <title>{{ lift_type }} Report</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="container py-4">

  <h1 class="mb-4">{{ lift_type }} Progress Report</h1>

  <!-- Filter Buttons -->
  <div class="btn-group mb-4" role="group">
    <a href="{{ url_for('report', lift_type=lift_type, range='week') }}" 
       class="btn {% if range_filter == 'week' %}btn-primary{% else %}btn-outline-primary{% endif %}">
       Last Week
    </a>
    <a href="{{ url_for('report', lift_type=lift_type, range='month') }}" 
       class="btn {% if range_filter == 'month' %}btn-primary{% else %}btn-outline-primary{% endif %}">
       Last Month
    </a>
    <a href="{{ url_for('report', lift_type=lift_type, range='year') }}" 
       class="btn {% if range_filter == 'year' %}btn-primary{% else %}btn-outline-primary{% endif %}">
       Last Year
    </a>
    <a href="{{ url_for('report', lift_type=lift_type, range='3year') }}" 
       class="btn {% if range_filter == '3year' %}btn-primary{% else %}btn-outline-primary{% endif %}">
       Last 3 Years
    </a>
    <a href="{{ url_for('report', lift_type=lift_type, range='5year') }}" 
       class="btn {% if range_filter == '5year' %}btn-primary{% else %}btn-outline-primary{% endif %}">
       Last 5 Years
    </a>
    <a href="{{ url_for('report', lift_type=lift_type, range='all') }}" 
       class="btn {% if range_filter == 'all' %}btn-primary{% else %}btn-outline-primary{% endif %}">
       All Time
    </a>
  </div>

  <!-- Tabs for Charts -->
  <ul class="nav nav-tabs" id="chartTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="weight-tab" data-bs-toggle="tab" data-bs-target="#weight" type="button" role="tab">Weight</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="reps-tab" data-bs-toggle="tab" data-bs-target="#reps" type="button" role="tab">Reps & Sets</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="oneRm-tab" data-bs-toggle="tab" data-bs-target="#oneRm" type="button" role="tab">Estimated 1RM</button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content mt-3">
    <div class="tab-pane fade show active" id="weight" role="tabpanel">
      <canvas id="weightChart"></canvas>
    </div>
    <div class="tab-pane fade" id="reps" role="tabpanel">
      <canvas id="repsChart"></canvas>
    </div>
    <div class="tab-pane fade" id="oneRm" role="tabpanel">
      <canvas id="oneRmChart"></canvas>
    </div>
  </div>

  <a href="/" class="btn btn-secondary mt-4">Back</a>

<script>
  const labels = {{ dates|tojson }};
  const weightData = {{ weights|tojson }};
  const repsData = {{ reps|tojson }};
  const setsData = {{ sets|tojson }};

  // Calculate Estimated 1RM (Epley Formula: weight * (1 + reps/30))
  const oneRmData = weightData.map((w, i) => {
    const r = repsData[i] || 1; // avoid division by zero
    return Math.round(w * (1 + r / 30));
  });

  // --- Weight Chart ---
  const weightChart = new Chart(document.getElementById('weightChart'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Weight (kg)',
        data: weightData,
        borderColor: 'blue',
        fill: false
      }]
    },
    options: {
      animation: {
        duration: 1500,
        easing: 'easeOutBounce'
      }
    }
  });

  // --- Reps & Sets Chart ---
  const repsChart = new Chart(document.getElementById('repsChart'), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        { label: 'Reps', data: repsData, backgroundColor: 'orange' },
        { label: 'Sets', data: setsData, backgroundColor: 'green' }
      ]
    },
    options: {
      animation: {
        duration: 1200,
        easing: 'easeInOutQuart'
      }
    }
  });

  // --- Estimated 1RM Chart ---
  const oneRmChart = new Chart(document.getElementById('oneRmChart'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Estimated 1RM (kg)',
        data: oneRmData,
        borderColor: 'red',
        fill: false
      }]
    },
    options: {
      animation: {
        duration: 1500,
        easing: 'easeInOutElastic'
      }
    }
  });

  // --- Re-trigger animations on tab switch ---
  document.querySelectorAll('button[data-bs-toggle="tab"]').forEach(tab => {
    tab.addEventListener('shown.bs.tab', function (event) {
      if (event.target.getAttribute("data-bs-target") === "#weight") {
        weightChart.update();
      }
      if (event.target.getAttribute("data-bs-target") === "#reps") {
        repsChart.update();
      }
      if (event.target.getAttribute("data-bs-target") === "#oneRm") {
        oneRmChart.update();
      }
    });
  });
</script>

</body>
</html>
